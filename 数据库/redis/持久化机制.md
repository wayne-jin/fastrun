# 持久化机制

Redis是一个支持持久化的内存数据库，通过持久化机制把内存中的数据同步到硬盘来保证数据持久化。当Redis重启后通过把硬盘文件重新加载到内存，就能达到恢复数据的目的

很多时候我们需要持久化数据也就是将内存中的数据写入到硬盘里面，大部分原因是为了之后重用数据(比如重启机器，机器故障之后回复数据)，或者防止系统故障而将数据备份到一个远程位置

实现：单独创建fork()一个子进程，将当前父进程的数据库数据复制到子进程的内存中，然后由子进程写入到临时文件中，持久化的过程结束了，再用这个临时文件替换上次的快照文件，然后子进程退出，内存释放

以下有两种持久化机制

* **快照持久化**
  Redis可以通过创建快照来获得存储在内存里的数据再某个时间点上的副本，Redis创建快照之后，可以对快照进行备份，可以将快照复制到其他服务器从而创建具有相同数据的服务器副本（Redis主从结构，主要用来提高Redis性能），还可以将快照留在原地一遍重启服务器的时候使用
* **AOF持久化**
  与快照持久化相比，AOF持久化的实时性更好，因此已成为主流的持久化方案。默认情况下Redis没有开启AOF的持久化方式。开启AOF持久化之后每执行一条会更改Redis中的数据的命令，Redis就会将该命令写入硬盘的AOF文件，AOF文件的保存位置和RDB文件的位置相同，都是通过dir参数设置的
