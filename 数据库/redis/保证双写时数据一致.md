# 保证双写时数据一致

首先说一句，你只要用缓存，就可能会涉及到缓存与数据库双存储双写，你只要是双写，就一定会有数据一致性问题，那么你如何解决数据一致性

一般来说，就是如果你的系统不是严格要求缓存+数据库必须一致性的化，缓存可以稍微的跟数据库偶尔有不一致的情况，最好不要做这个方案，最好将**读请求和写请求串行化**，串到一个内存队列里去，这样就可以保证一定不会出现不一致的情况

串行化之后，就会导致系统的吞吐量会大幅度降低，用比正常情况下多几倍的机器去支撑线上的一个请求

最近点的缓存+数据库的读写模式，就是**预留缓存模式**

* 读的时候，先读缓存，缓存没有的话，就读数据库，然后取出数据后放入缓存，同时返回响应
* 更新的时候，**先删除缓存，然后再更新数据库，这样读的时候就会发现缓存中没有数据而直接去数据库中拿数据了**

在高并发的业务场景下，数据库的性能瓶颈往往都是用户并发量过大。所以一般都使用Redis做一个缓冲操作，让请求先访问到Redis，而不是直接去访问Mysql等数据库，从而减少网络请求的延迟响应  




### 数据为什么会出现不一致的情况

根本原因：单库下，逻辑处理中消耗1s，可能读到旧数据入缓存
主从+读写分离，在1s的主从同步时延中，到从库的旧数据入缓存
