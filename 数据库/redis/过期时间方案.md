# 过期时间方案

Redis中有个设置过期时间的功能，即对存储在Redis数据库的值可以设置一个过期时间
作为一个缓存数据库，这是非常实用的，比如一些token或者登录信息，尤其是短信验证码都是有时间限制的，按照传统的数据库处理方式一般都是自己判断是否过期，这样无疑会严重影响项目性能

我们set key的时候，都可以给一个expire time就是过期时间，通过过期时间我们可以指定这个key可以存活的事件，主要可采用定期删除和惰性删除两种方案

* **定期删除**：Redis默认是每隔100ms就随机抽取一些设置了过期时间的key，检查其是否过期，如果过期就删除。注意这里是随机抽取的，为什么是随机的呢？如果Redis存了几十万个key，每隔100ms就遍历所有过期时间key的话，就会给CPU带来很大的负载

* **惰性删除**：定期删除可能会导致很多过期key到了时间并没有被删除掉，所以就有了惰性删除，它是指某个键值过期后，此键值不会马上被删除，而是等到下次被使用的时候，才会被检查到过期，这是才能得到删除，惰性删除的缺点很明显的是浪费内存，除非你的系统去查一下那个key，才会被redis删掉，这就是所谓的惰性删除    

  

### 定期和惰性一定能保证删除数据么？如果不能，Redis会有什么应对措施

并不能保证一定删除，Redis有一个Redis内存淘汰机制来确保数据一定会被删除

内存淘汰策略：

* 从已设置过期事件的数据集中挑选最近最少使用的数据淘汰
* 从已设置过期时间的数据集中挑选将要过期的数据淘汰
* 从已设置过期时间的数据集中任意选择数据淘汰
* 从数据集中挑选最近最少使用的数据淘汰    
  

### 假如Mysql有1000万数据，采用Redis作为中间缓存，取其中的10W，如何保证Redis中的数据都是热点数据？

可以使用Redis的数据淘汰策略，Redis内存数据集大小上升到一定大小的时候，就会实行这种策略
