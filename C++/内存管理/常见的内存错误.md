# 常见的内存错误

### 常见的内存错误

1.内存分配未成功，却使用了它
常见的解决办法是在使用内存之前检查指针是否为NULL。如果指针是函数的参数，那么在函数入口处用assert(p!=NULL)进行检查。如果是用malloc或new来申请内存，应该用if(p==NULL)或if(p!=NULL)进行防错处理

2.内存分配虽然成功，但是尚未初始化就引用它
犯这种错误主要是有两个起因：一是没有初始化的概念，二是误以为内存的缺省初值全为零，导致引用初值错误(例如数组)。内存的缺省初值究竟是什么没有统一的标准，尽管有时候为零值，我们宁可信其无不可信其有。所以无论如何用哪种方式创建数组，都别忘了赋初值，即使是赋零值也不可省略，不要嫌麻烦。

3.内存分配成功已经初始化，但操作越过了内存的边界
例如在使用数组时经常发生下标”多1“或者”少1“的操作。特别是在for循环语句中，循环次数很容易搞错，导致数组越界

4.忘记了释放内存，造成内存泄露
含有这种错误的函数每被调用一次就会丢失一块内存，刚开始时系统的内存充足，你看不到错误。终有一次程序突然死掉，系统出现提示：内存耗尽。动态的申请和释放必须配对，程序中malloc与free的次数一定要相同，否则肯定有错误

5.释放了内存却继续使用它
有三种情况：
1）程序中的对象调用过于复杂，实在难以搞清楚某个对象究竟是否已经释放了内存，此时应该重新设计数据结构，从根本上解决对象管理混乱的局面
2）函数的return语句写错了，注意不要返回指向”栈内存“的指针”或者引用“，因为该内存在函数体结束时被自动销毁
3）使用free或delete释放了内存后，没有将指针设置为NULL，导致产生”野指针“

【规则1】在使用malloc或new申请内存之后，应该立即检查指针值是否为NULL，防止使用指针值作为NULL的内存
【规则2】不要忘记为数组或动态内存赋初值。防止将违背初始化的内存作为右值使用
【规则3】避免数组或指针下标越界，特别当心发生”多1“或者”少1“操作
【规则4】动态内存的申请和释放必须配对，防止内存泄露
【规则5】用free或delete释放内存之后，立即将指针设置为NULL，防止产生野指针
