# 场景管理

游戏场景管理包括场景实现与场景管理实现。

**场景**
场景包括地图信息管理，场景对象管理，ai，场景视野管理，场景信息同步等。

**地图信息**

可以使用recastnavigation引擎，该引擎包括recast和detour两部分，recast是地图网格生成工具，detour是寻路引擎。具体可以参考recastnavigation

**场景对象管理**

管理场景中的所有对象的进出场景、创建、销毁等，包括人物、npc、怪物等。

**ai**

一般的mmo怪物ai可由状态机实现，复杂点的可以用行为树，推荐腾讯的behaviac

**场景视野管理**

场景内玩家可看到的其他对象。这里简单介绍下九宫格，把玩家周围分为3*3的九个格子，玩家处于最中心格内，玩家的视野就是九宫格内的所有对象。

**场景信息同步**

包括玩家的位置、外形、buf、技能动作等同步，当玩家移动时，将新进入自己视野的玩家加入到自己的视野管理中，并通知对方加入自己到其视野中。在游戏帧中同步视野中的对象信息给自己，为减少同步的数据量，可以只同步视野对象变更的信息。

**场景管理**
场景管理主要存储场景信息，包括静态场景、动态场景。静态场景指游戏启动后一直存在的场景（如主城），动态场景指动态创建、销毁的场景（如副本）。场景管理负责场景的创建、销毁、分派玩家进入的场景等。

**游戏内事件机制实现**
事件管理由map/unordered_map来存储，一个事件id对应事件处理回调。注册事件将事件id、事件处理回调函数存储到map中。事件发生后，根据事件id找出事件回调执行。
