# 交互通信协议的设计

通常来说，游戏交互通信协议使用二进制协议交互，包含 长度、协议标识 和 内容。

* 长度，整个协议包的大小，一般使用2字节标识，如传输数据过大，可以考虑2~4字节标识长度。

* 协议标识，协议包的标识，一般指协议id，使用2字节标识。

* 内容，协议包数据，一般是byte数组。目前最常用的是由protobuf编写协议包结构，经序列化发送给对端，对端取得数据后协议id反序列化出protobuf结构。

一般来说，为了安全服务器与客户端之间的协议还需要进行加密、解密等操作防止外挂行为



### protobuf

Protobuf 是 Protocol Buffers 的简称, 它是 Google 开发的一种跨语言、跨平台、可扩展的用于序列化数据协议，

Protobuf 可以用于结构化数据序列化(串行化)，它序列化出来的数据量少，再加上以 K-V 的方式来存储数据，非常适用于在网络通讯中的数据载体。

只要遵守一些简单的使用规则，可以做到非常好的兼容性和扩展性，可用于通讯协议、数据存储等领域的语言无关、平台无关、可扩展的序列化结构数据格式。

Protobuf 中最基本的数据单元是 message ，并且在 message 中可以多层嵌套 message 或其它的基础数据类型的成员。

Protobuf 是一种灵活，高效，自动化机制的结构数据序列化方法，可类比 XML，但是比 XML 更小（3 ~ 10倍）、更快（20 ~ 100倍）、更简单，而且它支持 Java、C++、Python 等多种语言。  


#### 针对程序升级的proto设计

  程序升级是常有的事，但我们升级的时候需要考虑兼容性，之前有看到过同个版本号如

  if (version == 1){

  }

  else if (version > 2)

  .........

  这样做的缺陷我就不在过多的说明了。

  对于proto的协议来说，我们只要做到以下几点，就会完美兼容新旧版本

* **不要随意添加或删除 required限定词修饰的字段**

* **不要随意改变现有字段编码值**

* **若需要新增字段，请用optional限定词修饰**



